import telebot
import os
from menu.keyboards import get_phone_keyboard  # –Ü–º–ø–æ—Ä—Ç—É—î–º–æ –∫–ª–∞–≤—ñ–∞—Ç—É—Ä—É –¥–ª—è –∑–∞–ø–∏—Ç—É —Ç–µ–ª–µ—Ñ–æ–Ω—É
from config.auth import check_user_in_database  # –Ü–º–ø–æ—Ä—Ç—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –Ω–æ–º–µ—Ä–∞ —É –±–∞–∑—ñ

# –û—Ç—Ä–∏–º—É—î–º–æ —Ç–æ–∫–µ–Ω –∑ –∑–º—ñ–Ω–Ω–æ—ó —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
TOKEN = os.getenv("TOKEN")  
bot = telebot.TeleBot(TOKEN)

@bot.message_handler(commands=['start'])
def send_welcome(message):
    """–ó–∞–ø–∏—Ç –Ω–∞ –Ω–∞–¥–∞–Ω–Ω—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó –ø—ñ—Å–ª—è –∫–æ–º–∞–Ω–¥–∏ /start."""
    # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ñ—É–Ω–∫—Ü—ñ—é get_phone_keyboard() –¥–ª—è –∑–∞–ø–∏—Ç—É —Ç—ñ–ª—å–∫–∏ –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É
    markup = get_phone_keyboard()  # –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ —Ç—ñ–ª—å–∫–∏ –æ–¥–Ω—É –∫–Ω–æ–ø–∫—É

    bot.send_message(
        message.chat.id,
        "–ü–æ–¥—ñ–ª—ñ—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó:",  # –¢–µ–∫—Å—Ç –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ü—ñ—ó
        reply_markup=markup  # –í—ñ–¥–ø—Ä–∞–≤–ª—è—î—Ç—å—Å—è —Ç—ñ–ª—å–∫–∏ –æ–¥–Ω–∞ –∫–Ω–æ–ø–∫–∞
    )

# –û–±—Ä–æ–±–Ω–∏–∫ –æ—Ç—Ä–∏–º–∞–Ω–æ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç—É
@bot.message_handler(content_types=['contact'])
def handle_contact(message):
    """–û–±—Ä–æ–±–ª—è—î –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–º–µ—Ä–∞ —Ç–µ–ª–µ—Ñ–æ–Ω—É –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ —Ç–∞ –ø–µ—Ä–µ–≤—ñ—Ä—è—î –π–æ–≥–æ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö."""
    if message.contact:
        phone_number = message.contact.phone_number

        # –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–æ–º–µ—Ä–∞ –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
        user_name, center = check_user_in_database(phone_number)

        if user_name:
            bot.send_message(
                message.chat.id,
                f"‚úÖ –í—ñ—Ç–∞—é, *{user_name}*! –í–∏ —É—Å–ø—ñ—à–Ω–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ. üéâ"
            )
        else:
            bot.send_message(
                message.chat.id,
                "–í–∞—à –Ω–æ–º–µ—Ä –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –≤ —Å–∏—Å—Ç–µ–º—ñ. –ó–≤–µ—Ä–Ω—ñ—Ç—å—Å—è –¥–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞."
            )

# –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
if __name__ == "__main__":
    print("–ë–æ—Ç –∑–∞–ø—É—â–µ–Ω–æ. –û—á—ñ–∫—É–≤–∞–Ω–Ω—è –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å...")
    bot.polling(none_stop=True)
